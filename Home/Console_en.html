<!DOCTYPE html>
<html lang="en">
<head>
    <title>Sapphire</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            background-color: #000000;
            color: white;
        }

        h1 {
            font-family: sans-serif;
        }

        h5 {
            font-family: sans-serif;
        }

        input {
            font-family: sans-serif;
            background-color: black;
            color: white; /* Changed to white for better visibility */
        }
    </style>
</head>
<body>
    <h1>Sapphire</h1>
    <div id="console"></div>
    <input id="input" type="text" placeholder="Type command...">
    <script>
        const newHeading = document.createElement('h5');
        newHeading.textContent = 'Welcome to Sapphire! For help, type "help"';
        newHeading.id = 'output';
        const condiv = document.getElementById('console');
        condiv.appendChild(newHeading);

        const input = document.getElementById('input');

        // Set up an event listener for the input field
        input.addEventListener('keydown', async function(event) {
            if (event.key === "Enter") {
                const inputValue = input.value.trim(); // Get the current input value
                const commandParts = inputValue.split(' '); // Split the input into parts

                // Function to create a server and save its info
                async function createServer() {
                    const correctServerAddress = prompt('PLEASE ENTER THE SERVER ADDRESS:');
                    const correctServerPort = prompt('PLEASE ENTER THE SERVER PORT:');
                    const correctServerPassword = prompt('PLEASE ENTER THE SERVER PASSWORD:');

                    // Save to session storage
                    sessionStorage.setItem('serverAddress', correctServerAddress);
                    sessionStorage.setItem('serverPort', correctServerPort);
                    sessionStorage.setItem('serverPassword', correctServerPassword);

                    // Create the object to save
                    const objectToSave = {
                        address: correctServerAddress,
                        port: correctServerPort,
                        password: correctServerPassword
                    };

                    // Send the object to the server
                    try {
                        const response = await fetch('http://localhost:3018/save-object', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(objectToSave) // Convert the object to JSON
                        });

                        const data = await response.json();
                        newHeading.textContent = data.message; // Display success message
                    } catch (error) {
                        console.error('Error saving object:', error);
                        newHeading.textContent = 'Error saving object.';
                    }
                }

                // Command handling
                if (commandParts[0] === "help") {
                    newHeading.textContent = 'Available Commands: help, connect [server IP], disconnect, exit, createServer.';
                } else if (commandParts[0] === "connect") {
                    if (commandParts.length === 2) {
                        const serverIP = commandParts[1]; // Get the server IP from the input
                        newHeading.textContent = `Connecting to server at ${serverIP}...`;
                        fetchServerInfo()
                        newHeading.textContent = `Connected to server at ${serverIP}.`;
                        var currentServer = serverIP;
                        if (currentServer === "brilliant.edu") {
                            window.location.href = "http://localhost:3018/edu";
                        }
                    } else {
                        newHeading.textContent = 'Usage: connect [server IP]';
                    }
                } else if (commandParts[0] === "exit") {
                    newHeading.textContent = 'Goodbye! Thank you for using Sapphire.';
                    input.disabled = true; // Disable the input field
                } else if (commandParts[0] === "createServer") {
                    await createServer(); // Call the createServer function
                } else if (commandParts[0] === "disconnect") {
                currentServer === null
                newHeading.textContent = 'Disconnected from server.';
                }
                else {
                    newHeading.textContent = 'Unknown command. Type "help" for assistance.';
                }
                input.value = ''; // Clear the input field after processing
            }
        });
async function fetchServerInfo() {
        try {
                const response = await fetch('http://localhost:3018/objects'); // Make a GET request
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const data = await response.json(); // Parse the JSON response
                // 
                
            } catch (error) {
                console.error('Error fetching server info:', error);
                newHeading.textContent = 'Error fetching server info.';
            }
        }
</script>
</body>
</html>
